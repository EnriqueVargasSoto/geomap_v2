import{b0 as A,b1 as P,P as D,L as U,M as B,r as V,N,b as r,a1 as j,i as M,j as G,G as H,c as O,o as $,e as o,a as z,F as K,d as m,m as a,H as W,t as x,bp as J,a9 as X,bs as R,aX as Y}from"./app-Cmn_N9n1.js";import{_ as Q,a as Z}from"./AppSelect-BBIyeNva.js";import{V as ee}from"./VNodeRenderer-BmV-tb2I.js";import{u as ae}from"./useAbility-gu4w5PNp.js";import{u as q}from"./useApi-CUtfkXns.js";import{V as I,a as b}from"./VRow-CJpev1j6.js";import{V as se}from"./VAvatar-BF_vJa7z.js";import{V as te}from"./VCard-CkRl-3_o.js";import{V as F}from"./VCardText-D5bMiqdB.js";import{c as re,d as le}from"./VInput-BbvKCV-Z.js";import{f as oe}from"./forwardRefs-kXjusgSh.js";import"./VTextField-B1t8Y1qw.js";import"./VList-C163Uj0B.js";import"./VDivider-Bq2-eXOl.js";import"./VMenu-DYoRoIb7.js";import"./VCheckboxBtn-qoMKorfF.js";import"./VSelectionControl-Cwsae0zx.js";import"./VChip-fgQ6fO8I.js";/* empty css              */import"./lazy-BRmMh5eO.js";const ne=l=>l==null,ue=l=>Array.isArray(l)&&l.length===0,S=l=>ne(l)||ue(l)||l===!1?"This field is required":!!String(l).trim().length||"This field is required",E=(l,h,g,c,i=!1)=>{const p=A(),{global:n}=P();return D(()=>n.name.value==="light"?p.skin==="bordered"&&i?g:l:n.name.value==="dark"?p.skin==="bordered"&&i?c:h:l)},ie="/build/assets/auth-v2-login-illustration-bordered-dark-cDkPk8mY.png",de="/build/assets/auth-v2-login-illustration-bordered-light-CIHqcIVA.png",me="/build/assets/auth-v2-login-illustration-dark-ClExSVqL.png",ce="/build/assets/auth-v2-login-illustration-light-C4sKfRS1.png",pe="/build/assets/misc-mask-dark-D4eSvDKH.png",fe="/build/assets/misc-mask-light-7GUBPWb3.png",ge=B({...j(),...le()},"VForm"),Ve=U()({name:"VForm",props:ge(),emits:{"update:modelValue":l=>!0,submit:l=>!0},setup(l,h){let{slots:g,emit:c}=h;const i=re(l),p=V();function n(u){u.preventDefault(),i.reset()}function y(u){const d=u,t=i.validate();d.then=t.then.bind(t),d.catch=t.catch.bind(t),d.finally=t.finally.bind(t),c("submit",d),d.defaultPrevented||t.then(_=>{var k;let{valid:C}=_;C&&((k=p.value)==null||k.submit())}),d.preventDefault()}return N(()=>{var u;return r("form",{ref:p,class:["v-form",l.class],style:l.style,novalidate:!0,onReset:n,onSubmit:y},[(u=g.default)==null?void 0:u.call(g,i)])}),oe(i,p)}}),ve={class:"auth-logo d-flex align-center gap-x-3"},be={class:"position-relative bg-background w-100 me-0"},he={class:"d-flex align-center justify-center w-100 h-100",style:{"padding-inline":"6.25rem"}},ye=["src"],Me={__name:"Index",setup(l){const h=E(ce,me,de,ie,!0),g=E(fe,pe),c=V(!1);M();const i=G(),p=ae(),n=V([]),y=V([]),u=V({empresa:null,sucursal:null,usuario:null,clave:null}),d=V(),t=V({empresa:null,sucursal:null,usuario:null,clave:null}),_=async()=>{console.log("form: ",t.value);try{const{data:e,error:s}=await q("/login",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t.value),onResponseError({response:w}){u.value.usuario=w.data.message}});console.log("data login:",e);const v=[{action:"manage",subject:"all"}];R("userAbilityRules").value=v,p.update(v),R("userData").value=e.value.user,R("accessToken").value=e.value.token,await Y(async()=>{await i.push({name:"/"})})}catch(e){console.error(e)}},C=()=>{var e;(e=d.value)==null||e.validate().then(({valid:s})=>{s&&_()})},k=async()=>{try{const{data:e}=await q("/empresas");n.value=(e==null?void 0:e.value.data)||[],t.value.empresa_id=n.value[0]?n.value[0].idEmpresa:null,y.value=n.value[0]?n.value[0].sucursales:[]}catch(e){console.error("Error al cargar la configuraci贸n de la tabla:",e)}},L=e=>{const s=n.value.find(v=>v.idEmpresa===e);y.value=s.sucursales,t.value.sucursal_id=null,console.log(t)};return H(async()=>{await k()}),(e,s)=>{const v=z("RouterLink"),w=Q,T=Z;return $(),O(K,null,[r(v,{to:"/"},{default:o(()=>[m("div",ve,[r(a(ee),{nodes:a(W).app.logo},null,8,["nodes"]),s[5]||(s[5]=m("h1",{class:"auth-title"}," Tracking ",-1))])]),_:1}),r(I,{"no-gutters":"",class:"auth-wrapper bg-surface"},{default:o(()=>[r(b,{md:"8",class:"d-none d-md-flex"},{default:o(()=>[m("div",be,[m("div",he,[r(se,{"max-width":"613",src:a(h),class:"auth-illustration mt-16 mb-2"},null,8,["src"])]),m("img",{class:"auth-footer-mask flip-in-rtl",src:a(g),alt:"auth-footer-mask",height:"280",width:"100"},null,8,ye)])]),_:1}),r(b,{cols:"12",md:"4",class:"auth-card-v2 d-flex align-center justify-center"},{default:o(()=>[r(te,{flat:"","max-width":500,class:"mt-12 mt-sm-0 pa-6"},{default:o(()=>[r(F,null,{default:o(()=>s[6]||(s[6]=[m("h4",{class:"text-h4 mb-1"},[x(" Welcome to "),m("span",{class:"text-capitalize"},"Tracking"),x("!  ")],-1),m("p",{class:"mb-0"},"Inicie sesi贸n en su cuenta y comience la aventura.",-1)])),_:1}),r(F,null,{default:o(()=>[r(Ve,{ref_key:"refVForm",ref:d,onSubmit:J(C,["prevent"])},{default:o(()=>[r(I,null,{default:o(()=>[r(b,{cols:"12"},{default:o(()=>[r(w,{modelValue:a(t).empresa,"onUpdate:modelValue":[s[0]||(s[0]=f=>a(t).empresa=f),L],items:a(n),"item-title":"razonSocial","item-value":"idEmpresa",label:"Empresa",placeholder:"Seleccione Empresa",rules:["requiredValidator"in e?e.requiredValidator:a(S)],"error-messages":a(u).empresa},null,8,["modelValue","items","rules","error-messages"])]),_:1}),r(b,{cols:"12"},{default:o(()=>[r(w,{modelValue:a(t).sucursal,"onUpdate:modelValue":s[1]||(s[1]=f=>a(t).sucursal=f),items:a(y),"item-title":"nombre","item-value":"idSucursal",label:"Sucursal",placeholder:"Seleccione Sucursal",rules:["requiredValidator"in e?e.requiredValidator:a(S)],"error-messages":a(u).sucursal},null,8,["modelValue","items","rules","error-messages"])]),_:1}),r(b,{cols:"12"},{default:o(()=>[r(T,{modelValue:a(t).usuario,"onUpdate:modelValue":s[2]||(s[2]=f=>a(t).usuario=f),autofocus:"",label:"Usuario",type:"text",placeholder:"Usuario",rules:["requiredValidator"in e?e.requiredValidator:a(S)],"error-messages":a(u).usuario},null,8,["modelValue","rules","error-messages"])]),_:1}),r(b,{cols:"12"},{default:o(()=>[r(T,{modelValue:a(t).clave,"onUpdate:modelValue":s[3]||(s[3]=f=>a(t).clave=f),label:"Password",placeholder:"路路路路路路路路路路路路",type:a(c)?"text":"password",rules:["requiredValidator"in e?e.requiredValidator:a(S)],"error-messages":a(u).clave,autocomplete:"password","append-inner-icon":a(c)?"tabler-eye-off":"tabler-eye","onClick:appendInner":s[4]||(s[4]=f=>c.value=!a(c))},null,8,["modelValue","type","rules","error-messages","append-inner-icon"]),s[8]||(s[8]=m("div",{class:"d-flex align-center flex-wrap justify-space-between my-6"},null,-1)),r(X,{block:"",type:"submit"},{default:o(()=>s[7]||(s[7]=[x(" Login ")])),_:1})]),_:1})]),_:1})]),_:1},512)]),_:1})]),_:1})]),_:1})]),_:1})],64)}}};export{Me as default};
