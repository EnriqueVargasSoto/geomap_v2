import{b1 as A,b2 as D,Q as P,M as B,N as U,r as h,O as M,b as l,a2 as j,i as N,j as G,G as O,c as $,o as z,e as o,a as H,F as K,d as m,m as a,t as C,bq as Q,aa as Y,bi as q,aY as J}from"./app-CzwwxCtj.js";import{_ as W,a as X}from"./AppSelect-C4PefNcB.js";import{u as Z}from"./useAbility-uYrgUCOc.js";import{u as I}from"./useApi-DjTJxAe9.js";import{V as F,a as b}from"./VRow-DhwhKXJY.js";import{V as ee}from"./VAvatar-DzFrs1hm.js";import{V as ae}from"./VCard-BznVZU1Y.js";import{V as T}from"./VCardText-DKCb8tg2.js";import{c as se,d as te}from"./VInput-DW7n3D3_.js";import{f as re}from"./forwardRefs-DtCVdgnc.js";import"./VTextField-CRWHjjxq.js";import"./VList-C9VO5XvE.js";import"./VDivider-DfRR_wjQ.js";import"./VMenu-BBfeCjJF.js";import"./VCheckboxBtn-B4N-WUUh.js";import"./VSelectionControl-CmwuQylI.js";import"./VChip-DXKG0IUw.js";/* empty css              */import"./lazy-Dcd2WvLl.js";const le=r=>r==null,oe=r=>Array.isArray(r)&&r.length===0,w=r=>le(r)||oe(r)||r===!1?"This field is required":!!String(r).trim().length||"This field is required",E=(r,V,g,c,u=!1)=>{const p=A(),{global:n}=D();return P(()=>n.name.value==="light"?p.skin==="bordered"&&u?g:r:n.name.value==="dark"?p.skin==="bordered"&&u?c:V:r)},ne="/build/assets/auth-v2-login-illustration-bordered-dark-cDkPk8mY.png",ie="/build/assets/auth-v2-login-illustration-bordered-light-CIHqcIVA.png",ue="/build/assets/auth-v2-login-illustration-dark-ClExSVqL.png",de="/build/assets/auth-v2-login-illustration-light-C4sKfRS1.png",me="/build/assets/misc-mask-dark-D4eSvDKH.png",ce="/build/assets/misc-mask-light-7GUBPWb3.png",pe="/build/assets/xalesmap_high_quality-Cy-aQn4G.png",fe=U({...j(),...te()},"VForm"),ge=B()({name:"VForm",props:fe(),emits:{"update:modelValue":r=>!0,submit:r=>!0},setup(r,V){let{slots:g,emit:c}=V;const u=se(r),p=h();function n(i){i.preventDefault(),u.reset()}function y(i){const d=i,s=u.validate();d.then=s.then.bind(s),d.catch=s.catch.bind(s),d.finally=s.finally.bind(s),c("submit",d),d.defaultPrevented||s.then(S=>{var k;let{valid:x}=S;x&&((k=p.value)==null||k.submit())}),d.preventDefault()}return M(()=>{var i;return l("form",{ref:p,class:["v-form",r.class],style:r.style,novalidate:!0,onReset:n,onSubmit:y},[(i=g.default)==null?void 0:i.call(g,u)])}),re(u,p)}}),he={class:"auth-logo d-flex align-center gap-x-3"},ve=["src"],be={class:"position-relative bg-background w-100 me-0"},Ve={class:"d-flex align-center justify-center w-100 h-100",style:{"padding-inline":"6.25rem"}},ye=["src"],je={__name:"Index",setup(r){const V=E(de,ue,ie,ne,!0),g=E(ce,me),c=h(!1);N();const u=G(),p=Z(),n=h([]),y=h([]),i=h({empresa:null,sucursal:null,usuario:null,clave:null}),d=h(),s=h({empresa:null,sucursal:null,usuario:null,clave:null}),S=async()=>{console.log("form: ",s.value);try{const{data:e,error:t}=await I("/login",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(s.value),onResponseError({response:_}){i.value.usuario=_.data.message}});console.log("data login:",e);const v=[{action:"manage",subject:"all"}];q("userAbilityRules").value=v,p.update(v),q("userData").value=e.value.user,q("accessToken").value=e.value.token,await J(async()=>{await u.push({name:"/"})})}catch(e){console.error(e)}},x=()=>{var e;(e=d.value)==null||e.validate().then(({valid:t})=>{t&&S()})},k=async()=>{try{const{data:e}=await I("/empresas");n.value=(e==null?void 0:e.value.data)||[],s.value.empresa_id=n.value[0]?n.value[0].idEmpresa:null,y.value=n.value[0]?n.value[0].sucursales:[]}catch(e){console.error("Error al cargar la configuración de la tabla:",e)}},L=e=>{const t=n.value.find(v=>v.idEmpresa===e);y.value=t.sucursales,s.value.sucursal_id=null,console.log(s)};return O(async()=>{await k()}),(e,t)=>{const v=H("RouterLink"),_=W,R=X;return z(),$(K,null,[l(v,{to:"/"},{default:o(()=>[m("div",he,[m("img",{src:a(pe),alt:"Logo",style:{height:"70px"}},null,8,ve)])]),_:1}),l(F,{"no-gutters":"",class:"auth-wrapper bg-surface"},{default:o(()=>[l(b,{md:"8",class:"d-none d-md-flex"},{default:o(()=>[m("div",be,[m("div",Ve,[l(ee,{"max-width":"613",src:a(V),class:"auth-illustration mt-16 mb-2"},null,8,["src"])]),m("img",{class:"auth-footer-mask flip-in-rtl",src:a(g),alt:"auth-footer-mask",height:"280",width:"100"},null,8,ye)])]),_:1}),l(b,{cols:"12",md:"4",class:"auth-card-v2 d-flex align-center justify-center"},{default:o(()=>[l(ae,{flat:"","max-width":500,class:"mt-12 mt-sm-0 pa-6"},{default:o(()=>[l(T,null,{default:o(()=>t[5]||(t[5]=[m("h4",{class:"text-h4 mb-1"},[C(" Binvenido a "),m("span",{class:"text-capitalize"},"GeoMap"),C("! 👋🏻 ")],-1),m("p",{class:"mb-0"},"Inicie sesión en su cuenta.",-1)])),_:1}),l(T,null,{default:o(()=>[l(ge,{ref_key:"refVForm",ref:d,onSubmit:Q(x,["prevent"])},{default:o(()=>[l(F,null,{default:o(()=>[l(b,{cols:"12"},{default:o(()=>[l(_,{modelValue:a(s).empresa,"onUpdate:modelValue":[t[0]||(t[0]=f=>a(s).empresa=f),L],items:a(n),"item-title":"razonSocial","item-value":"idEmpresa",label:"Empresa",placeholder:"Seleccione Empresa",rules:["requiredValidator"in e?e.requiredValidator:a(w)],"error-messages":a(i).empresa},null,8,["modelValue","items","rules","error-messages"])]),_:1}),l(b,{cols:"12"},{default:o(()=>[l(_,{modelValue:a(s).sucursal,"onUpdate:modelValue":t[1]||(t[1]=f=>a(s).sucursal=f),items:a(y),"item-title":"nombre","item-value":"idSucursal",label:"Sucursal",placeholder:"Seleccione Sucursal",rules:["requiredValidator"in e?e.requiredValidator:a(w)],"error-messages":a(i).sucursal},null,8,["modelValue","items","rules","error-messages"])]),_:1}),l(b,{cols:"12"},{default:o(()=>[l(R,{modelValue:a(s).usuario,"onUpdate:modelValue":t[2]||(t[2]=f=>a(s).usuario=f),autofocus:"",label:"Usuario",type:"text",placeholder:"Usuario",rules:["requiredValidator"in e?e.requiredValidator:a(w)],"error-messages":a(i).usuario},null,8,["modelValue","rules","error-messages"])]),_:1}),l(b,{cols:"12"},{default:o(()=>[l(R,{modelValue:a(s).clave,"onUpdate:modelValue":t[3]||(t[3]=f=>a(s).clave=f),label:"Password",placeholder:"············",type:a(c)?"text":"password",rules:["requiredValidator"in e?e.requiredValidator:a(w)],"error-messages":a(i).clave,autocomplete:"password","append-inner-icon":a(c)?"tabler-eye-off":"tabler-eye","onClick:appendInner":t[4]||(t[4]=f=>c.value=!a(c))},null,8,["modelValue","type","rules","error-messages","append-inner-icon"]),t[7]||(t[7]=m("div",{class:"d-flex align-center flex-wrap justify-space-between my-6"},null,-1)),l(Y,{block:"",type:"submit"},{default:o(()=>t[6]||(t[6]=[C(" Login ")])),_:1})]),_:1})]),_:1})]),_:1},512)]),_:1})]),_:1})]),_:1})]),_:1})],64)}}};export{je as default};
