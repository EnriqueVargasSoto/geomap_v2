import{b0 as A,b1 as P,P as D,L as U,M as B,r as v,N,b as r,a1 as j,i as M,j as G,G as H,c as O,o as $,e as o,a as z,F as K,d as m,m as a,H as W,t as C,bp as J,a9 as X,bs as x,aX as Y}from"./app-B3I6Gn6w.js";import{_ as Q,a as Z}from"./AppSelect-CyY_lZ3g.js";import{V as ee}from"./VNodeRenderer-BQBjBc1R.js";import{u as ae}from"./useAbility-B8w35vNn.js";import{u as q}from"./useApi-CUPPgiIn.js";import{V as I,a as b}from"./VRow-Cndp14Ie.js";import{V as se}from"./VAvatar-C88WUKqv.js";import{V as te}from"./VCard-lN0AGtO-.js";import{V as F}from"./VCardText-CiPrMgC8.js";import{c as re,d as le}from"./VInput-BYPdfyFM.js";import{f as oe}from"./forwardRefs-CqTrOdMG.js";import"./VTextField-nIffNosU.js";import"./VList-BXVPbkuE.js";import"./VDivider-C-gOVGMm.js";import"./VMenu-DNY-0EPW.js";import"./VSelectionControl-DBKfETbf.js";import"./VChip-CDASnbN1.js";/* empty css              */import"./lazy-CXxlMPyB.js";const ne=l=>l==null,ie=l=>Array.isArray(l)&&l.length===0,_=l=>ne(l)||ie(l)||l===!1?"This field is required":!!String(l).trim().length||"This field is required",E=(l,h,g,c,u=!1)=>{const p=A(),{global:n}=P();return D(()=>n.name.value==="light"?p.skin==="bordered"&&u?g:l:n.name.value==="dark"?p.skin==="bordered"&&u?c:h:l)},ue="/build/assets/auth-v2-login-illustration-bordered-dark-cDkPk8mY.png",de="/build/assets/auth-v2-login-illustration-bordered-light-CIHqcIVA.png",me="/build/assets/auth-v2-login-illustration-dark-ClExSVqL.png",ce="/build/assets/auth-v2-login-illustration-light-C4sKfRS1.png",pe="/build/assets/misc-mask-dark-D4eSvDKH.png",fe="/build/assets/misc-mask-light-7GUBPWb3.png",ge=B({...j(),...le()},"VForm"),ve=U()({name:"VForm",props:ge(),emits:{"update:modelValue":l=>!0,submit:l=>!0},setup(l,h){let{slots:g,emit:c}=h;const u=re(l),p=v();function n(i){i.preventDefault(),u.reset()}function y(i){const d=i,s=u.validate();d.then=s.then.bind(s),d.catch=s.catch.bind(s),d.finally=s.finally.bind(s),c("submit",d),d.defaultPrevented||s.then(w=>{var k;let{valid:S}=w;S&&((k=p.value)==null||k.submit())}),d.preventDefault()}return N(()=>{var i;return r("form",{ref:p,class:["v-form",l.class],style:l.style,novalidate:!0,onReset:n,onSubmit:y},[(i=g.default)==null?void 0:i.call(g,u)])}),oe(u,p)}}),Ve={class:"auth-logo d-flex align-center gap-x-3"},be={class:"position-relative bg-background w-100 me-0"},he={class:"d-flex align-center justify-center w-100 h-100",style:{"padding-inline":"6.25rem"}},ye=["src"],je={__name:"Index",setup(l){const h=E(ce,me,de,ue,!0),g=E(fe,pe),c=v(!1);M();const u=G(),p=ae(),n=v([]),y=v([]),i=v({empresa_id:null,sucursal_id:null,usuario:null,clave:null}),d=v(),s=v({empresa_id:null,sucursal_id:null,usuario:null,clave:null}),w=async()=>{console.log("form: ",s.value);try{const{data:e,error:t}=await q("/login",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({idEmpresa:s.value.empresa_id,idSucursal:s.value.sucursal_id,usuario:s.value.usuario,clave:s.value.clave})});console.log("data login:",e);const V=[{action:"manage",subject:"all"}];x("userAbilityRules").value=V,p.update(V),x("userData").value=e.value.user,x("accessToken").value=e.value.token,await Y(async()=>{await u.push({name:"/"})})}catch(e){console.error(e)}},S=()=>{var e;(e=d.value)==null||e.validate().then(({valid:t})=>{t&&w()})},k=async()=>{try{const{data:e}=await q("/empresas");n.value=(e==null?void 0:e.value.data)||[],s.value.empresa_id=n.value[0]?n.value[0].idEmpresa:null,y.value=n.value[0]?n.value[0].sucursales:[]}catch(e){console.error("Error al cargar la configuración de la tabla:",e)}},L=e=>{const t=n.value.find(V=>V.idEmpresa===e);y.value=t.sucursales,s.value.sucursal_id=null,console.log(s)};return H(async()=>{await k()}),(e,t)=>{const V=z("RouterLink"),R=Q,T=Z;return $(),O(K,null,[r(V,{to:"/"},{default:o(()=>[m("div",Ve,[r(a(ee),{nodes:a(W).app.logo},null,8,["nodes"]),t[5]||(t[5]=m("h1",{class:"auth-title"}," Tracking ",-1))])]),_:1}),r(I,{"no-gutters":"",class:"auth-wrapper bg-surface"},{default:o(()=>[r(b,{md:"8",class:"d-none d-md-flex"},{default:o(()=>[m("div",be,[m("div",he,[r(se,{"max-width":"613",src:a(h),class:"auth-illustration mt-16 mb-2"},null,8,["src"])]),m("img",{class:"auth-footer-mask flip-in-rtl",src:a(g),alt:"auth-footer-mask",height:"280",width:"100"},null,8,ye)])]),_:1}),r(b,{cols:"12",md:"4",class:"auth-card-v2 d-flex align-center justify-center"},{default:o(()=>[r(te,{flat:"","max-width":500,class:"mt-12 mt-sm-0 pa-6"},{default:o(()=>[r(F,null,{default:o(()=>t[6]||(t[6]=[m("h4",{class:"text-h4 mb-1"},[C(" Welcome to "),m("span",{class:"text-capitalize"},"Tracking"),C("! 👋🏻 ")],-1),m("p",{class:"mb-0"},"Inicie sesión en su cuenta y comience la aventura.",-1)])),_:1}),r(F,null,{default:o(()=>[r(ve,{ref_key:"refVForm",ref:d,onSubmit:J(S,["prevent"])},{default:o(()=>[r(I,null,{default:o(()=>[r(b,{cols:"12"},{default:o(()=>[r(R,{modelValue:a(s).empresa_id,"onUpdate:modelValue":[t[0]||(t[0]=f=>a(s).empresa_id=f),L],items:a(n),"item-title":"razonSocial","item-value":"idEmpresa",label:"Empresa",placeholder:"Seleccione Empresa",rules:["requiredValidator"in e?e.requiredValidator:a(_)],"error-messages":a(i).empresa_id},null,8,["modelValue","items","rules","error-messages"])]),_:1}),r(b,{cols:"12"},{default:o(()=>[r(R,{modelValue:a(s).sucursal_id,"onUpdate:modelValue":t[1]||(t[1]=f=>a(s).sucursal_id=f),items:a(y),"item-title":"nombre","item-value":"idSucursal",label:"Sucursal",placeholder:"Seleccione Sucursal",rules:["requiredValidator"in e?e.requiredValidator:a(_)],"error-messages":a(i).sucursal_id},null,8,["modelValue","items","rules","error-messages"])]),_:1}),r(b,{cols:"12"},{default:o(()=>[r(T,{modelValue:a(s).usuario,"onUpdate:modelValue":t[2]||(t[2]=f=>a(s).usuario=f),autofocus:"",label:"Usuario",type:"text",placeholder:"Usuario",rules:["requiredValidator"in e?e.requiredValidator:a(_)],"error-messages":a(i).usuario},null,8,["modelValue","rules","error-messages"])]),_:1}),r(b,{cols:"12"},{default:o(()=>[r(T,{modelValue:a(s).clave,"onUpdate:modelValue":t[3]||(t[3]=f=>a(s).clave=f),label:"Password",placeholder:"············",type:a(c)?"text":"password",rules:["requiredValidator"in e?e.requiredValidator:a(_)],"error-messages":a(i).clave,autocomplete:"password","append-inner-icon":a(c)?"tabler-eye-off":"tabler-eye","onClick:appendInner":t[4]||(t[4]=f=>c.value=!a(c))},null,8,["modelValue","type","rules","error-messages","append-inner-icon"]),t[8]||(t[8]=m("div",{class:"d-flex align-center flex-wrap justify-space-between my-6"},null,-1)),r(X,{block:"",type:"submit"},{default:o(()=>t[7]||(t[7]=[C(" Login ")])),_:1})]),_:1})]),_:1})]),_:1},512)]),_:1})]),_:1})]),_:1})]),_:1})],64)}}};export{je as default};
